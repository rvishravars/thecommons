name: Version Consistency Check (v2.0)

on:
  pull_request:
    paths:
      - 'docs/MANIFESTO.md'
      - 'README.md'

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Extract and Validate Versions
        run: |
          # 1. Identify Version in Manifesto
          # Pattern: Master Framework (v2.0)
          MANIFESTO_VERSION=$(grep -oP 'Master Framework \(v\K[0-9.]+' docs/MANIFESTO.md | head -1)
          
          # 2. Identify Version in README
          # This pattern is more flexible to catch "Manifesto v2.0" inside or outside of links
          README_VERSION=$(grep -oP '(Manifesto v|Framework \(v)\K[0-9.]+' README.md | head -1)
          
          echo "üîç Diagnostic Output:"
          echo "Found in Manifesto: v$MANIFESTO_VERSION"
          echo "Found in README:    v$README_VERSION"
          
          # 3. Validation Logic
          if [ -z "$MANIFESTO_VERSION" ]; then
            echo "‚ùå Error: Could not find version string in docs/MANIFESTO.md"
            exit 1
          fi

          if [ -z "$README_VERSION" ]; then
            echo "‚ùå Error: Could not find version string in README.md"
            echo "üí° Tip: Ensure README contains 'Manifesto v$MANIFESTO_VERSION' or 'Master Framework (v$MANIFESTO_VERSION)'"
            exit 1
          fi
          
          if [ "$MANIFESTO_VERSION" != "$README_VERSION" ]; then
            echo ""
            echo "‚ùå VERSION MISMATCH!"
            echo "The version in docs/MANIFESTO.md (v$MANIFESTO_VERSION) does not match README.md (v$README_VERSION)"
            exit 1
          fi
          
          echo ""
          echo "‚úÖ Logic Check Passed: Versions are synchronized at v$MANIFESTO_VERSION"