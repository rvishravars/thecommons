name: Version Consistency Check (v2.0)

on:
  pull_request:
    paths:
      - 'docs/MANIFESTO.md'
      - 'README.md'
      - 'scripts/novelty_scan.py' # Added this because the script also tracks version logic

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Extract and Validate Versions
        run: |
          # 1. Check for file existence to prevent workflow failure
          if [ ! -f "docs/MANIFESTO.md" ]; then
            echo "⚠️ docs/MANIFESTO.md not found. If you merged it into README, please update this workflow."
            exit 0
          fi

          # 2. Extract versions using the v2.0 pattern
          MANIFESTO_VERSION=$(grep -oP 'Master Framework \(v\K[0-9.]+' docs/MANIFESTO.md | head -1)
          README_VERSION=$(grep -oP 'Manifesto v\K[0-9.]+' README.md | head -1)
          
          echo "Manifesto version: v$MANIFESTO_VERSION"
          echo "README version: v$README_VERSION"
          
          # 3. Check consistency
          if [ "$MANIFESTO_VERSION" != "$README_VERSION" ]; then
            echo ""
            echo "❌ Version mismatch detected!"
            echo "Manifesto: v$MANIFESTO_VERSION"
            echo "README:    v$README_VERSION"
            echo "⚠️ Ensure the 'Master Framework' version in docs/MANIFESTO.md matches the 'Manifesto vX.X' tag in README.md."
            exit 1
          fi
          
          echo "✅ All version references are consistent: v$MANIFESTO_VERSION"